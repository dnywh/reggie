revoke delete on table "public"."conversations" from "anon";

revoke insert on table "public"."conversations" from "anon";

revoke references on table "public"."conversations" from "anon";

revoke select on table "public"."conversations" from "anon";

revoke trigger on table "public"."conversations" from "anon";

revoke truncate on table "public"."conversations" from "anon";

revoke update on table "public"."conversations" from "anon";

revoke delete on table "public"."conversations" from "authenticated";

revoke insert on table "public"."conversations" from "authenticated";

revoke references on table "public"."conversations" from "authenticated";

revoke select on table "public"."conversations" from "authenticated";

revoke trigger on table "public"."conversations" from "authenticated";

revoke truncate on table "public"."conversations" from "authenticated";

revoke update on table "public"."conversations" from "authenticated";

revoke delete on table "public"."conversations" from "service_role";

revoke insert on table "public"."conversations" from "service_role";

revoke references on table "public"."conversations" from "service_role";

revoke select on table "public"."conversations" from "service_role";

revoke trigger on table "public"."conversations" from "service_role";

revoke truncate on table "public"."conversations" from "service_role";

revoke update on table "public"."conversations" from "service_role";

revoke delete on table "public"."messages" from "anon";

revoke insert on table "public"."messages" from "anon";

revoke references on table "public"."messages" from "anon";

revoke select on table "public"."messages" from "anon";

revoke trigger on table "public"."messages" from "anon";

revoke truncate on table "public"."messages" from "anon";

revoke update on table "public"."messages" from "anon";

revoke delete on table "public"."messages" from "authenticated";

revoke insert on table "public"."messages" from "authenticated";

revoke references on table "public"."messages" from "authenticated";

revoke select on table "public"."messages" from "authenticated";

revoke trigger on table "public"."messages" from "authenticated";

revoke truncate on table "public"."messages" from "authenticated";

revoke update on table "public"."messages" from "authenticated";

revoke delete on table "public"."messages" from "service_role";

revoke insert on table "public"."messages" from "service_role";

revoke references on table "public"."messages" from "service_role";

revoke select on table "public"."messages" from "service_role";

revoke trigger on table "public"."messages" from "service_role";

revoke truncate on table "public"."messages" from "service_role";

revoke update on table "public"."messages" from "service_role";

revoke delete on table "public"."pending_replies" from "anon";

revoke insert on table "public"."pending_replies" from "anon";

revoke references on table "public"."pending_replies" from "anon";

revoke select on table "public"."pending_replies" from "anon";

revoke trigger on table "public"."pending_replies" from "anon";

revoke truncate on table "public"."pending_replies" from "anon";

revoke update on table "public"."pending_replies" from "anon";

revoke delete on table "public"."pending_replies" from "authenticated";

revoke insert on table "public"."pending_replies" from "authenticated";

revoke references on table "public"."pending_replies" from "authenticated";

revoke select on table "public"."pending_replies" from "authenticated";

revoke trigger on table "public"."pending_replies" from "authenticated";

revoke truncate on table "public"."pending_replies" from "authenticated";

revoke update on table "public"."pending_replies" from "authenticated";

revoke delete on table "public"."pending_replies" from "service_role";

revoke insert on table "public"."pending_replies" from "service_role";

revoke references on table "public"."pending_replies" from "service_role";

revoke select on table "public"."pending_replies" from "service_role";

revoke trigger on table "public"."pending_replies" from "service_role";

revoke truncate on table "public"."pending_replies" from "service_role";

revoke update on table "public"."pending_replies" from "service_role";

revoke delete on table "public"."preference_tokens" from "anon";

revoke insert on table "public"."preference_tokens" from "anon";

revoke references on table "public"."preference_tokens" from "anon";

revoke select on table "public"."preference_tokens" from "anon";

revoke trigger on table "public"."preference_tokens" from "anon";

revoke truncate on table "public"."preference_tokens" from "anon";

revoke update on table "public"."preference_tokens" from "anon";

revoke delete on table "public"."preference_tokens" from "authenticated";

revoke insert on table "public"."preference_tokens" from "authenticated";

revoke references on table "public"."preference_tokens" from "authenticated";

revoke select on table "public"."preference_tokens" from "authenticated";

revoke trigger on table "public"."preference_tokens" from "authenticated";

revoke truncate on table "public"."preference_tokens" from "authenticated";

revoke update on table "public"."preference_tokens" from "authenticated";

revoke delete on table "public"."preference_tokens" from "service_role";

revoke insert on table "public"."preference_tokens" from "service_role";

revoke references on table "public"."preference_tokens" from "service_role";

revoke select on table "public"."preference_tokens" from "service_role";

revoke trigger on table "public"."preference_tokens" from "service_role";

revoke truncate on table "public"."preference_tokens" from "service_role";

revoke update on table "public"."preference_tokens" from "service_role";

revoke delete on table "public"."reports" from "anon";

revoke insert on table "public"."reports" from "anon";

revoke references on table "public"."reports" from "anon";

revoke select on table "public"."reports" from "anon";

revoke trigger on table "public"."reports" from "anon";

revoke truncate on table "public"."reports" from "anon";

revoke update on table "public"."reports" from "anon";

revoke delete on table "public"."reports" from "authenticated";

revoke insert on table "public"."reports" from "authenticated";

revoke references on table "public"."reports" from "authenticated";

revoke select on table "public"."reports" from "authenticated";

revoke trigger on table "public"."reports" from "authenticated";

revoke truncate on table "public"."reports" from "authenticated";

revoke update on table "public"."reports" from "authenticated";

revoke delete on table "public"."reports" from "service_role";

revoke insert on table "public"."reports" from "service_role";

revoke references on table "public"."reports" from "service_role";

revoke select on table "public"."reports" from "service_role";

revoke trigger on table "public"."reports" from "service_role";

revoke truncate on table "public"."reports" from "service_role";

revoke update on table "public"."reports" from "service_role";

revoke delete on table "public"."runs" from "anon";

revoke insert on table "public"."runs" from "anon";

revoke references on table "public"."runs" from "anon";

revoke select on table "public"."runs" from "anon";

revoke trigger on table "public"."runs" from "anon";

revoke truncate on table "public"."runs" from "anon";

revoke update on table "public"."runs" from "anon";

revoke delete on table "public"."runs" from "authenticated";

revoke insert on table "public"."runs" from "authenticated";

revoke references on table "public"."runs" from "authenticated";

revoke select on table "public"."runs" from "authenticated";

revoke trigger on table "public"."runs" from "authenticated";

revoke truncate on table "public"."runs" from "authenticated";

revoke update on table "public"."runs" from "authenticated";

revoke delete on table "public"."runs" from "service_role";

revoke insert on table "public"."runs" from "service_role";

revoke references on table "public"."runs" from "service_role";

revoke select on table "public"."runs" from "service_role";

revoke trigger on table "public"."runs" from "service_role";

revoke truncate on table "public"."runs" from "service_role";

revoke update on table "public"."runs" from "service_role";

revoke delete on table "public"."strava_webhook_subscription" from "anon";

revoke insert on table "public"."strava_webhook_subscription" from "anon";

revoke references on table "public"."strava_webhook_subscription" from "anon";

revoke select on table "public"."strava_webhook_subscription" from "anon";

revoke trigger on table "public"."strava_webhook_subscription" from "anon";

revoke truncate on table "public"."strava_webhook_subscription" from "anon";

revoke update on table "public"."strava_webhook_subscription" from "anon";

revoke delete on table "public"."strava_webhook_subscription" from "authenticated";

revoke insert on table "public"."strava_webhook_subscription" from "authenticated";

revoke references on table "public"."strava_webhook_subscription" from "authenticated";

revoke select on table "public"."strava_webhook_subscription" from "authenticated";

revoke trigger on table "public"."strava_webhook_subscription" from "authenticated";

revoke truncate on table "public"."strava_webhook_subscription" from "authenticated";

revoke update on table "public"."strava_webhook_subscription" from "authenticated";

revoke delete on table "public"."strava_webhook_subscription" from "service_role";

revoke insert on table "public"."strava_webhook_subscription" from "service_role";

revoke references on table "public"."strava_webhook_subscription" from "service_role";

revoke select on table "public"."strava_webhook_subscription" from "service_role";

revoke trigger on table "public"."strava_webhook_subscription" from "service_role";

revoke truncate on table "public"."strava_webhook_subscription" from "service_role";

revoke update on table "public"."strava_webhook_subscription" from "service_role";

revoke delete on table "public"."training_plan" from "anon";

revoke insert on table "public"."training_plan" from "anon";

revoke references on table "public"."training_plan" from "anon";

revoke select on table "public"."training_plan" from "anon";

revoke trigger on table "public"."training_plan" from "anon";

revoke truncate on table "public"."training_plan" from "anon";

revoke update on table "public"."training_plan" from "anon";

revoke delete on table "public"."training_plan" from "authenticated";

revoke insert on table "public"."training_plan" from "authenticated";

revoke references on table "public"."training_plan" from "authenticated";

revoke select on table "public"."training_plan" from "authenticated";

revoke trigger on table "public"."training_plan" from "authenticated";

revoke truncate on table "public"."training_plan" from "authenticated";

revoke update on table "public"."training_plan" from "authenticated";

revoke delete on table "public"."training_plan" from "service_role";

revoke insert on table "public"."training_plan" from "service_role";

revoke references on table "public"."training_plan" from "service_role";

revoke select on table "public"."training_plan" from "service_role";

revoke trigger on table "public"."training_plan" from "service_role";

revoke truncate on table "public"."training_plan" from "service_role";

revoke update on table "public"."training_plan" from "service_role";

revoke delete on table "public"."users" from "anon";

revoke insert on table "public"."users" from "anon";

revoke references on table "public"."users" from "anon";

revoke select on table "public"."users" from "anon";

revoke trigger on table "public"."users" from "anon";

revoke truncate on table "public"."users" from "anon";

revoke update on table "public"."users" from "anon";

revoke delete on table "public"."users" from "authenticated";

revoke insert on table "public"."users" from "authenticated";

revoke references on table "public"."users" from "authenticated";

revoke select on table "public"."users" from "authenticated";

revoke trigger on table "public"."users" from "authenticated";

revoke truncate on table "public"."users" from "authenticated";

revoke update on table "public"."users" from "authenticated";

revoke delete on table "public"."users" from "service_role";

revoke insert on table "public"."users" from "service_role";

revoke references on table "public"."users" from "service_role";

revoke select on table "public"."users" from "service_role";

revoke trigger on table "public"."users" from "service_role";

revoke truncate on table "public"."users" from "service_role";

revoke update on table "public"."users" from "service_role";

alter table "public"."preference_tokens" drop constraint "preference_tokens_action_check";

alter table "public"."preference_tokens" add constraint "preference_tokens_action_check" CHECK (((action)::text = ANY ((ARRAY['pause'::character varying, 'resume'::character varying, 'disconnect'::character varying, 'data_request'::character varying])::text[]))) not valid;

alter table "public"."preference_tokens" validate constraint "preference_tokens_action_check";

set check_function_bodies = off;

CREATE OR REPLACE FUNCTION public.cleanup_expired_tokens()
 RETURNS integer
 LANGUAGE plpgsql
AS $function$
DECLARE
  deleted_count INTEGER;
BEGIN
  DELETE FROM preference_tokens 
  WHERE expires_at < NOW() OR (used = TRUE AND used_at < NOW() - INTERVAL '7 days');
  
  GET DIAGNOSTICS deleted_count = ROW_COUNT;
  RETURN deleted_count;
END;
$function$
;



